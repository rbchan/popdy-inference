\documentclass[color=usenames,dvipsnames]{beamer}\usepackage[]{graphicx}\usepackage[]{color}
% maxwidth is the original width if it is less than linewidth
% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0, 0, 0}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.69,0.494,0}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.749,0.012,0.012}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.514,0.506,0.514}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0,0,0}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0,0.341,0.682}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0,0,0}{\textbf{#1}}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.004,0.004,0.506}{#1}}%
\let\hlipl\hlkwb

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
%\documentclass[color=usenames,dvipsnames,handout]{beamer}

\usepackage[roman]{../lectures}
%\usepackage[sans]{../lectures}


\hypersetup{pdfpagemode=UseNone,pdfstartview={FitV}}


% Compile and open PDF






%% New command for inline code that isn't to be evaluated
\definecolor{inlinecolor}{rgb}{0.878, 0.918, 0.933}
\newcommand{\inr}[1]{\colorbox{inlinecolor}{\texttt{#1}}}



% \newcommand{\bxt}{${\bm x}_j$}
% \newcommand{\bx}{{\bm x}}
% \newcommand{\bxj}{{\bm x}_j}
% \newcommand{\bst}{${\bm s}_i$}
% \newcommand{\bs}{{\bm s}}
% \newcommand{\bsi}{{\bm s}_i}
% \newcommand{\ed}{\|\bx - \bs\|}
% \newcommand{\cs}{\mathcal{S} }
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}





\begin{frame}[plain]
  \centering
  \LARGE
  Classical survival analysis \\
  \vfill
  \large
  WILD(FISH) 8390 \\
  Estimation of Fish and Wildlife Population Parameters \\
  \vfill
  Richard Chandler \\
  University of Georgia \\
\end{frame}




%\section{Intro}



\begin{frame}[plain]
  \frametitle{Topics}
  \Large
  \only<1>{\tableofcontents}%[hideallsubsections]}
%  \only<2 | handout:0>{\tableofcontents[currentsection]}%,hideallsubsections]}
\end{frame}




\section{Intro}





\begin{frame}
  \frametitle{Open populations}
  \large
  Overview
  \begin{itemize}[<+->]
    \normalsize
    \item Population closure is an assumption we make to estimate
      density in short time periods
    \item If we want to study the processes governing spatial and
      temporal variation in density, we need to move beyond closed
      population models
    \item Open population SCR models allow us to model spatial and
      temporal variation in survival, recruitment, and movement
  \end{itemize}
\end{frame}





\section{Continuous-time models}



\begin{frame}
  \frametitle{Hazard}
  \[
    \lambda(t) = \lim_{\Delta_t \to 0} \Pr(t \le T < t+\Delta_t | T\ge t)/\Delta_t
  \]
\end{frame}


\begin{frame}
  \frametitle{Survivorship}
  \[
    S(t) = \exp\left(-\int_{0}^t \lambda(j) \,dj\right)
  \]
\end{frame}


\begin{frame}
  \frametitle{Probability density}
  \[
    p(t) = \lambda(t)\exp\left(-\int_{0}^t \lambda(j) \,dj\right)
  \]
\end{frame}





\begin{frame}[fragile]
  \frametitle{Simulating CJS data without robust design}
  {%\bf
    Parameters and dimensions}
  %\small
\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{T} \hlkwb{<-} \hlnum{10}               \hlcom{## primary periods (eg, years)}
\hlstd{K} \hlkwb{<-} \hlnum{1}                \hlcom{## only 1 secondary sampling occasion}
\hlstd{n} \hlkwb{<-} \hlnum{25}
\hlstd{phi} \hlkwb{<-} \hlnum{0.7}
\hlstd{p} \hlkwb{<-} \hlnum{0.4}
\hlstd{z} \hlkwb{<-} \hlkwd{matrix}\hlstd{(}\hlnum{NA}\hlstd{, n, T)}
\hlstd{y} \hlkwb{<-} \hlkwd{matrix}\hlstd{(}\hlnum{NA}\hlstd{, n, T)}
\hlstd{first} \hlkwb{<-} \hlkwd{rpois}\hlstd{(n,} \hlnum{1}\hlstd{)}\hlopt{+}\hlnum{1} \hlcom{## random release dates}
\end{alltt}
\end{kframe}
\end{knitrout}
\pause
\vfill
{%\bf
  Generate $z$ and $y$}
\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwa{for}\hlstd{(i} \hlkwa{in} \hlnum{1}\hlopt{:}\hlstd{n) \{}
    \hlstd{z[i,first[i]]} \hlkwb{<-} \hlnum{1}  \hlcom{## Known alive at release}
    \hlstd{y[i,first[i]]} \hlkwb{<-} \hlnum{1}
    \hlkwa{for}\hlstd{(t} \hlkwa{in} \hlstd{(first[i]}\hlopt{+}\hlnum{1}\hlstd{)}\hlopt{:}\hlstd{T) \{}
        \hlstd{z[i,t]} \hlkwb{<-} \hlkwd{rbinom}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{1}\hlstd{, z[i,t}\hlopt{-}\hlnum{1}\hlstd{]}\hlopt{*}\hlstd{phi)} \hlcom{## Alive/dead state}
        \hlstd{y[i,t]} \hlkwb{<-} \hlkwd{rbinom}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{1}\hlstd{, z[i,t]}\hlopt{*}\hlstd{p)}     \hlcom{## Data}
    \hlstd{\}}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}




\begin{frame}[fragile]
  \frametitle{Simulated CJS data}
  \begin{columns}
    \tiny
    \begin{column}{0.5\textwidth}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{z[,}\hlnum{1}\hlopt{:}\hlnum{7}\hlstd{]}
\end{alltt}
\begin{verbatim}
##       [,1] [,2] [,3] [,4] [,5] [,6] [,7]
##  [1,]    1    0    0    0    0    0    0
##  [2,]   NA    1    1    1    1    0    0
##  [3,]   NA    1    1    0    0    0    0
##  [4,]    1    0    0    0    0    0    0
##  [5,]    1    1    1    0    0    0    0
##  [6,]   NA    1    1    1    1    0    0
##  [7,]   NA   NA    1    0    0    0    0
##  [8,]   NA   NA   NA    1    1    1    1
##  [9,]    1    1    0    0    0    0    0
## [10,]    1    0    0    0    0    0    0
## [11,]    1    1    1    1    0    0    0
## [12,]    1    0    0    0    0    0    0
## [13,]   NA   NA    1    0    0    0    0
## [14,]    1    0    0    0    0    0    0
## [15,]   NA    1    1    1    1    0    0
## [16,]    1    1    1    1    1    0    0
## [17,]    1    0    0    0    0    0    0
## [18,]    1    1    1    0    0    0    0
## [19,]    1    0    0    0    0    0    0
## [20,]   NA    1    1    0    0    0    0
## [21,]   NA   NA    1    1    0    0    0
## [22,]   NA    1    1    1    0    0    0
## [23,]   NA    1    0    0    0    0    0
## [24,]    1    0    0    0    0    0    0
## [25,]   NA    1    1    1    0    0    0
\end{verbatim}
\end{kframe}
\end{knitrout}
    \end{column}
    \begin{column}{0.5\textwidth}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{y[,}\hlnum{1}\hlopt{:}\hlnum{7}\hlstd{]}
\end{alltt}
\begin{verbatim}
##       [,1] [,2] [,3] [,4] [,5] [,6] [,7]
##  [1,]    1    0    0    0    0    0    0
##  [2,]   NA    1    0    0    1    0    0
##  [3,]   NA    1    0    0    0    0    0
##  [4,]    1    0    0    0    0    0    0
##  [5,]    1    0    1    0    0    0    0
##  [6,]   NA    1    0    0    1    0    0
##  [7,]   NA   NA    1    0    0    0    0
##  [8,]   NA   NA   NA    1    0    0    1
##  [9,]    1    0    0    0    0    0    0
## [10,]    1    0    0    0    0    0    0
## [11,]    1    1    0    0    0    0    0
## [12,]    1    0    0    0    0    0    0
## [13,]   NA   NA    1    0    0    0    0
## [14,]    1    0    0    0    0    0    0
## [15,]   NA    1    0    0    0    0    0
## [16,]    1    0    1    0    1    0    0
## [17,]    1    0    0    0    0    0    0
## [18,]    1    1    0    0    0    0    0
## [19,]    1    0    0    0    0    0    0
## [20,]   NA    1    0    0    0    0    0
## [21,]   NA   NA    1    1    0    0    0
## [22,]   NA    1    1    1    0    0    0
## [23,]   NA    1    0    0    0    0    0
## [24,]    1    0    0    0    0    0    0
## [25,]   NA    1    1    1    0    0    0
\end{verbatim}
\end{kframe}
\end{knitrout}
    \end{column}
  \end{columns}
\end{frame}



\subsection{Likelihood}


\begin{frame}[plain]
  \frametitle{Topics}
  \Large
  \tableofcontents[currentsection,currentsubsection]
\end{frame}






\begin{frame}[fragile]
  \frametitle{Likelihood analysis}
  \small
  We can fit CJS models in R with the `RMark' or `marked'
  packages. We'll use `marked', which requires the capture histories
  to be formatted as a character vector named \inr{ch}. 
\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{library}\hlstd{(marked)}
\hlstd{y.marked} \hlkwb{<-} \hlkwd{ifelse}\hlstd{(}\hlkwd{is.na}\hlstd{(y),} \hlnum{0}\hlstd{, y)}
\hlstd{cap.histories} \hlkwb{<-} \hlkwd{data.frame}\hlstd{(}
    \hlkwc{ch}\hlstd{=}\hlkwd{apply}\hlstd{(y.marked,} \hlnum{1}\hlstd{, paste,} \hlkwc{collapse}\hlstd{=}\hlstr{""}\hlstd{))}
\hlkwd{head}\hlstd{(cap.histories,} \hlkwc{n}\hlstd{=}\hlnum{3}\hlstd{)}
\end{alltt}
\begin{verbatim}
##           ch
## 1 1000000000
## 2 0100100000
## 3 0100000000
\end{verbatim}
\end{kframe}
\end{knitrout}
  \pause
  \vfill
  You can use the formulas to add covariates.
\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{fm0} \hlkwb{<-} \hlkwd{crm}\hlstd{(}\hlkwc{data}\hlstd{=cap.histories,} \hlkwc{model}\hlstd{=}\hlstr{"CJS"}\hlstd{,} \hlkwc{hessian}\hlstd{=}\hlnum{TRUE}\hlstd{,}
           \hlkwc{model.parameters}\hlstd{=}\hlkwd{list}\hlstd{(}\hlkwc{Phi}\hlstd{=}\hlkwd{list}\hlstd{(}\hlkwc{formula}\hlstd{=}\hlopt{~}\hlnum{1}\hlstd{),}
                                 \hlkwc{p}\hlstd{=}\hlkwd{list}\hlstd{(}\hlkwc{formula}\hlstd{=}\hlopt{~}\hlnum{1}\hlstd{)))}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}





\begin{frame}[fragile]
  \frametitle{Likelihood analysis}
  Estimates of apparent survival and capture probability.
\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{predict}\hlstd{(fm0)}
\end{alltt}
\begin{verbatim}
## $Phi
##   occ estimate         se       lcl       ucl
## 1   4 0.617999 0.08624809 0.4415182 0.7680138
## 
## $p
##   occ  estimate        se       lcl       ucl
## 1   5 0.3242274 0.1095067 0.1526448 0.5609906
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}




\subsection{Bayesian}



\begin{frame}[plain]
  \frametitle{Topics}
  \Large
  \tableofcontents[currentsection,currentsubsection]
\end{frame}


\begin{frame}[fragile]
  \frametitle{Non-spatial CJS model in JAGS}
%  \scriptsize \fbox{\parbox{\linewidth}{\verbatiminput{CJS-nonspatial.jag}}}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{writeLines}\hlstd{(}\hlkwd{readLines}\hlstd{(}\hlstr{"CJS-nonspatial.jag"}\hlstd{))}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in file(con, "{}r"{}): cannot open file 'CJS-nonspatial.jag': No such file or directory}}

{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in file(con, "{}r"{}): cannot open the connection}}\end{kframe}
\end{knitrout}
\end{frame}







\begin{frame}[fragile]
  \frametitle{JAGS}
  Data
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{jags.data.nonsp} \hlkwb{<-} \hlkwd{list}\hlstd{(}\hlkwc{y}\hlstd{=y,} \hlkwc{n}\hlstd{=n,} \hlkwc{first}\hlstd{=first,} \hlkwc{T}\hlstd{=T)}
\end{alltt}
\end{kframe}
\end{knitrout}
  \pause
  \vfill
  Initial values for $z$ matrix
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{zi.nonsp} \hlkwb{<-} \hlkwd{matrix}\hlstd{(}\hlnum{NA}\hlstd{, n, T)}
\hlkwa{for}\hlstd{(i} \hlkwa{in} \hlnum{1}\hlopt{:}\hlstd{n) \{}
    \hlstd{zi.nonsp[i,(first[i]}\hlopt{+}\hlnum{1}\hlstd{)}\hlopt{:}\hlstd{T]} \hlkwb{<-} \hlnum{1}
    \hlstd{\}}
\hlstd{jags.inits.nonsp} \hlkwb{<-} \hlkwa{function}\hlstd{()} \hlkwd{list}\hlstd{(}\hlkwc{phi}\hlstd{=}\hlkwd{runif}\hlstd{(}\hlnum{1}\hlstd{),} \hlkwc{p}\hlstd{=}\hlkwd{runif}\hlstd{(}\hlnum{1}\hlstd{),} \hlkwc{z}\hlstd{=zi.nonsp)}
\hlstd{jags.pars.nonsp} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlstr{"phi"}\hlstd{,} \hlstr{"p"}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
  \pause
  \vfill
  {%\bf \normalsize
    Fit the model}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{library}\hlstd{(jagsUI)}
\hlstd{jags.post.samples.nonsp} \hlkwb{<-} \hlkwd{jags.basic}\hlstd{(}\hlkwc{data}\hlstd{=jags.data.nonsp,}
                                      \hlkwc{inits}\hlstd{=jags.inits.nonsp,}
                                      \hlkwc{parameters.to.save}\hlstd{=jags.pars.nonsp,}
                                      \hlkwc{model.file}\hlstd{=}\hlstr{"CJS-nonspatial.jag"}\hlstd{,}
                                      \hlkwc{n.chains}\hlstd{=}\hlnum{3}\hlstd{,} \hlkwc{n.adapt}\hlstd{=}\hlnum{100}\hlstd{,} \hlkwc{n.burnin}\hlstd{=}\hlnum{0}\hlstd{,}
                                      \hlkwc{n.iter}\hlstd{=}\hlnum{2000}\hlstd{,} \hlkwc{parallel}\hlstd{=}\hlnum{TRUE}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}









\begin{frame}[fragile]
  \frametitle{Posterior distributions}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{plot}\hlstd{(jags.post.samples.nonsp)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=0.65\linewidth]{figure/jc1-plot-1} 

}


\end{knitrout}
\end{frame}








\section{Spatial CJS}



\begin{frame}[plain]
  \frametitle{Topics}
  \Large
  \tableofcontents[currentsection]
\end{frame}


\begin{frame}
  \frametitle{Spatial CJS}
  \large
  Why spatial?
  \begin{itemize}
    \normalsize
    \item Comes with all the benefits of other SCR models
    \item Allows for movement between primary periods, making
      it possible to separate survival from permanent emigration
    \item Movement itself may be of interest, such as in studies of
      dispersal
  \end{itemize}
  \pause
  \vfill
  \normalsize
  {\centering %\bf
    We begin by ignoring movement, but we use the robust design \\ }
\end{frame}




\begin{frame}[fragile]
  \frametitle{Simulating spatial CJS data with robust design}
  \scriptsize %\footnotesize
  \begin{columns}
%      \column{\dimexpr\paperwidth-10pt}
    \begin{column}{0.5\textwidth}%{0.5\dimexpr\paperwidth-10pt}
      {%\bf
        Parameters and data dimensions}
\begin{knitrout}\tiny
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{T} \hlkwb{<-} \hlnum{10}       \hlcom{# primary occasions}
\hlstd{K} \hlkwb{<-} \hlnum{3}        \hlcom{# secondary occasions}
\hlstd{n} \hlkwb{<-} \hlnum{25}       \hlcom{# nIndividuals}
\hlstd{phi} \hlkwb{<-} \hlnum{0.7}
\hlstd{p0} \hlkwb{<-} \hlnum{0.4}     \hlcom{# baseline capture prob}
\hlstd{sigma} \hlkwb{<-} \hlnum{0.1}  \hlcom{# scale parameter}
\end{alltt}
\end{kframe}
\end{knitrout}
\pause
{%\bf
  Traps, activity centers, and \\ detection probability}
\begin{knitrout}\tiny
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{co} \hlkwb{<-} \hlkwd{seq}\hlstd{(}\hlnum{0.25}\hlstd{,} \hlnum{0.75}\hlstd{,} \hlkwc{length}\hlstd{=}\hlnum{5}\hlstd{)}
\hlstd{x} \hlkwb{<-} \hlkwd{cbind}\hlstd{(}\hlkwd{rep}\hlstd{(co,} \hlkwc{each}\hlstd{=}\hlnum{5}\hlstd{),}
           \hlkwd{rep}\hlstd{(co,} \hlkwc{times}\hlstd{=}\hlnum{5}\hlstd{))}
\hlstd{J} \hlkwb{<-} \hlkwd{nrow}\hlstd{(x)}
\hlstd{xlim} \hlkwb{<-} \hlstd{ylim} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,}\hlnum{1}\hlstd{)}
\hlstd{s} \hlkwb{<-} \hlkwd{cbind}\hlstd{(}\hlkwd{runif}\hlstd{(n, xlim[}\hlnum{1}\hlstd{], xlim[}\hlnum{2}\hlstd{]),}
           \hlkwd{runif}\hlstd{(n, ylim[}\hlnum{1}\hlstd{], ylim[}\hlnum{2}\hlstd{]))}
\hlstd{d} \hlkwb{<-} \hlstd{p.sp} \hlkwb{<-} \hlkwd{matrix}\hlstd{(}\hlnum{NA}\hlstd{, n, J)}
\hlkwa{for}\hlstd{(i} \hlkwa{in} \hlnum{1}\hlopt{:}\hlstd{n) \{}
    \hlstd{d[i,]} \hlkwb{<-} \hlkwd{sqrt}\hlstd{((s[i,}\hlnum{1}\hlstd{]}\hlopt{-}\hlstd{x[,}\hlnum{1}\hlstd{])}\hlopt{^}\hlnum{2} \hlopt{+}
                  \hlstd{(s[i,}\hlnum{2}\hlstd{]}\hlopt{-}\hlstd{x[,}\hlnum{2}\hlstd{])}\hlopt{^}\hlnum{2}\hlstd{)}
    \hlstd{p.sp[i,]} \hlkwb{<-} \hlstd{p0}\hlopt{*}\hlkwd{exp}\hlstd{(}\hlopt{-}\hlstd{d[i,]}\hlopt{^}\hlnum{2}\hlopt{/}\hlstd{(}\hlnum{2}\hlopt{*}\hlstd{sigma}\hlopt{^}\hlnum{2}\hlstd{))}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}
    \end{column}
\pause
%\vfill
\begin{column}{0.5\textwidth}%{0.5\dimexpr\paperwidth-10pt}
\scriptsize %\tiny
{%\bf
  Generate $z$ and $y$}
\begin{knitrout}\tiny
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{z} \hlkwb{<-} \hlkwd{matrix}\hlstd{(}\hlnum{NA}\hlstd{, n, T)}
\hlstd{y.sp} \hlkwb{<-} \hlkwd{array}\hlstd{(}\hlnum{NA}\hlstd{,} \hlkwd{c}\hlstd{(n, J, K, T))} \hlcom{## 4D array}
\hlstd{first} \hlkwb{<-} \hlkwd{rpois}\hlstd{(n,} \hlnum{1}\hlstd{)}\hlopt{+}\hlnum{1} \hlcom{## random release dates}
\hlkwa{for}\hlstd{(i} \hlkwa{in} \hlnum{1}\hlopt{:}\hlstd{n) \{}
    \hlstd{z[i,first[i]]} \hlkwb{<-} \hlnum{1}
    \hlkwa{for}\hlstd{(t} \hlkwa{in} \hlstd{(first[i]}\hlopt{+}\hlnum{1}\hlstd{)}\hlopt{:}\hlstd{T) \{}
        \hlstd{z[i,t]} \hlkwb{<-} \hlkwd{rbinom}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{1}\hlstd{,}
                         \hlstd{z[i,t}\hlopt{-}\hlnum{1}\hlstd{]}\hlopt{*}\hlstd{phi)}
        \hlkwa{for}\hlstd{(j} \hlkwa{in} \hlnum{1}\hlopt{:}\hlstd{J) \{}
            \hlstd{y.sp[i,j,}\hlnum{1}\hlopt{:}\hlstd{K,t]} \hlkwb{<-} \hlkwd{rbinom}\hlstd{(K,} \hlnum{1}\hlstd{,}
                \hlstd{z[i,t]}\hlopt{*}\hlstd{p.sp[i,j])}
        \hlstd{\}}
    \hlstd{\}}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}
  \end{column}
\end{columns}
\end{frame}






\subsection{Likelihood}


\begin{frame}[plain]
  \frametitle{Topics}
  \Large
  \tableofcontents[currentsection,currentsubsection]
\end{frame}





\begin{frame}[fragile]
  \frametitle{Likelihood analysis of spatial CJS model}
  We'll use the R package `openpopscr' for model fitting. It isn't on
  CRAN, but you can install it from github using the following
  commands.
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{library}\hlstd{(remotes)}
\hlkwd{install_github}\hlstd{(}\hlstr{"r-glennie/openpopscr"}\hlstd{,} \hlkwc{build} \hlstd{=} \hlnum{TRUE}\hlstd{,}
               \hlkwc{build_opts} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"--no-resave-data"}\hlstd{,} \hlstr{"--no-manual"}\hlstd{),}
               \hlkwc{build_vignettes} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\hlkwd{library}\hlstd{(openpopscr)}
\hlkwd{library}\hlstd{(secr)}
\end{alltt}
\end{kframe}
\end{knitrout}
\vfill
If you're on Windows, you might have to install Rtools first. \\
\centering
\url{https://cran.r-project.org/bin/windows/Rtools/} \\

\end{frame}



\begin{frame}[fragile]
  \frametitle{Likelihood analysis of spatial CJS model}
Begin by making a mask in `secr'
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{trap.df} \hlkwb{<-} \hlkwd{data.frame}\hlstd{(x}\hlopt{*}\hlnum{1000}\hlstd{);} \hlkwd{colnames}\hlstd{(trap.df)} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlstr{"x"}\hlstd{,}\hlstr{"y"}\hlstd{)}
\hlstd{traps} \hlkwb{<-} \hlkwd{read.traps}\hlstd{(}\hlkwc{data}\hlstd{=trap.df,} \hlkwc{detector}\hlstd{=}\hlstr{"proximity"}\hlstd{)}
\hlstd{mask} \hlkwb{<-} \hlkwd{make.mask}\hlstd{(}\hlkwc{traps}\hlstd{=traps,} \hlkwc{buffer}\hlstd{=}\hlnum{250}\hlstd{)}
\hlkwd{plot}\hlstd{(mask);} \hlkwd{points}\hlstd{(traps,} \hlkwc{pch}\hlstd{=}\hlnum{3}\hlstd{,} \hlkwc{col}\hlstd{=}\hlstr{"blue"}\hlstd{,} \hlkwc{lwd}\hlstd{=}\hlnum{2}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=0.6\linewidth]{figure/mask-1} 

}


\end{knitrout}
\end{frame}


\begin{frame}[fragile]
  \frametitle{Likelihood analysis of spatial CJS model}
Format for `secr'
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{y.sp.secr} \hlkwb{<-} \hlstd{y.sp; y.sp.secr[}\hlkwd{is.na}\hlstd{(y.sp)]} \hlkwb{<-} \hlnum{0}
\hlstd{caps} \hlkwb{<-} \hlkwd{data.frame}\hlstd{(}\hlkwc{session}\hlstd{=}\hlnum{1}\hlstd{,}
                   \hlkwc{animal}\hlstd{=}\hlkwd{rep}\hlstd{(}\hlkwd{slice.index}\hlstd{(y.sp.secr,} \hlnum{1}\hlstd{), y.sp.secr),}
                   \hlkwc{occasion}\hlstd{=}\hlkwd{rep}\hlstd{(}\hlkwd{slice.index}\hlstd{(y.sp.secr,} \hlnum{3}\hlopt{:}\hlnum{4}\hlstd{), y.sp.secr),}
                   \hlkwc{trap}\hlstd{=}\hlkwd{rep}\hlstd{(}\hlkwd{slice.index}\hlstd{(y.sp.secr,} \hlnum{2}\hlstd{), y.sp.secr))}
\hlstd{capthist} \hlkwb{<-} \hlkwd{make.capthist}\hlstd{(}\hlkwc{captures}\hlstd{=caps,} \hlkwc{traps}\hlstd{=traps,} \hlkwc{noccasions}\hlstd{=}\hlnum{30}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
\vfill
Then format for `openpopscr'
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{cjs.data} \hlkwb{<-} \hlstd{ScrData}\hlopt{$}\hlkwd{new}\hlstd{(capthist, mask,} \hlkwc{primary}\hlstd{=}\hlkwd{rep}\hlstd{(}\hlnum{1}\hlopt{:}\hlnum{10}\hlstd{,} \hlkwc{each}\hlstd{=}\hlnum{3}\hlstd{))}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}


\begin{frame}[fragile]
  \frametitle{Likelihood analysis}
Create the model object and the fit it
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mod} \hlkwb{<-} \hlstd{CjsModel}\hlopt{$}\hlkwd{new}\hlstd{(}\hlkwd{list}\hlstd{(lambda0}\hlopt{~}\hlnum{1}\hlstd{, sigma}\hlopt{~}\hlnum{1}\hlstd{, phi}\hlopt{~}\hlnum{1}\hlstd{), cjs.data,}
                    \hlkwc{start}\hlstd{=}\hlkwd{list}\hlstd{(}\hlkwc{lambda0}\hlstd{=}\hlnum{1.5}\hlstd{,} \hlkwc{sigma}\hlstd{=}\hlnum{50}\hlstd{,} \hlkwc{phi}\hlstd{=}\hlnum{0.5}\hlstd{))}
\hlstd{mod}\hlopt{$}\hlkwd{fit}\hlstd{()}
\hlstd{mod}
\end{alltt}
\end{kframe}
\end{knitrout}
Back-transform
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mod}\hlopt{$}\hlkwd{get_par}\hlstd{(}\hlstr{"lambda0"}\hlstd{,} \hlkwc{k} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{j} \hlstd{=} \hlnum{1}\hlstd{)}
\end{alltt}
\begin{verbatim}
## [1] 0.3824823
\end{verbatim}
\begin{alltt}
\hlstd{mod}\hlopt{$}\hlkwd{get_par}\hlstd{(}\hlstr{"sigma"}\hlstd{,} \hlkwc{k} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{j} \hlstd{=} \hlnum{1}\hlstd{)}
\end{alltt}
\begin{verbatim}
## [1] 102.0998
\end{verbatim}
\begin{alltt}
\hlstd{mod}\hlopt{$}\hlkwd{get_par}\hlstd{(}\hlstr{"phi"}\hlstd{,} \hlkwc{k} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{m}\hlstd{=}\hlnum{1}\hlstd{)}
\end{alltt}
\begin{verbatim}
## [1] 0.5708015
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}





\subsection{Bayesian}



\begin{frame}[plain]
  \frametitle{Topics}
  \Large
  \tableofcontents[currentsection,currentsubsection]
\end{frame}




\begin{frame}[fragile]
  \frametitle{Spatial CJS model in JAGS}
%  \vspace{-5mm}
%  \scriptsize \fbox{\parbox{\linewidth}{\verbatiminput{CJS-spatial.jag}}}
\begin{knitrout}\tiny
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{writeLines}\hlstd{(}\hlkwd{readLines}\hlstd{(}\hlstr{"CJS-spatial.jag"}\hlstd{))}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in file(con, "{}r"{}): cannot open file 'CJS-spatial.jag': No such file or directory}}

{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in file(con, "{}r"{}): cannot open the connection}}\end{kframe}
\end{knitrout}
\end{frame}





\begin{frame}[fragile]
  \frametitle{JAGS}
  Data
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{jags.data.sp} \hlkwb{<-} \hlkwd{list}\hlstd{(}\hlkwc{y}\hlstd{=y.sp,} \hlkwc{n}\hlstd{=n,} \hlkwc{first}\hlstd{=first,} \hlkwc{x}\hlstd{=x,}
                     \hlkwc{J}\hlstd{=J,} \hlkwc{K}\hlstd{=K,} \hlkwc{T}\hlstd{=T,} \hlkwc{xlim}\hlstd{=xlim,} \hlkwc{ylim}\hlstd{=ylim)}
\end{alltt}
\end{kframe}
\end{knitrout}
  Initial values for $z$ matrix
  \scriptsize
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{zi.sp} \hlkwb{<-} \hlkwd{matrix}\hlstd{(}\hlnum{NA}\hlstd{, n, T)}
\hlkwa{for}\hlstd{(i} \hlkwa{in} \hlnum{1}\hlopt{:}\hlstd{n) \{}
    \hlstd{zi.sp[i,(first[i]}\hlopt{+}\hlnum{1}\hlstd{)}\hlopt{:}\hlstd{T]} \hlkwb{<-} \hlnum{1}
    \hlstd{\}}
\hlstd{jags.inits.sp} \hlkwb{<-} \hlkwa{function}\hlstd{()} \hlkwd{list}\hlstd{(}\hlkwc{phi}\hlstd{=}\hlkwd{runif}\hlstd{(}\hlnum{1}\hlstd{),} \hlkwc{z}\hlstd{=zi.sp)}
\hlstd{jags.pars.sp} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlstr{"phi"}\hlstd{,} \hlstr{"p0"}\hlstd{,} \hlstr{"sigma"}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
\pause
\vfill
  {\normalsize Fit the model}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{jags.post.samples.sp} \hlkwb{<-} \hlkwd{jags.basic}\hlstd{(}\hlkwc{data}\hlstd{=jags.data.sp,}
                                   \hlkwc{inits}\hlstd{=jags.inits.sp,}
                                   \hlkwc{parameters.to.save}\hlstd{=jags.pars.sp,}
                                   \hlkwc{model.file}\hlstd{=}\hlstr{"CJS-spatial.jag"}\hlstd{,}
                                   \hlkwc{n.chains}\hlstd{=}\hlnum{3}\hlstd{,} \hlkwc{n.adapt}\hlstd{=}\hlnum{100}\hlstd{,} \hlkwc{n.burnin}\hlstd{=}\hlnum{0}\hlstd{,}
                                   \hlkwc{n.iter}\hlstd{=}\hlnum{2000}\hlstd{,} \hlkwc{parallel}\hlstd{=}\hlnum{TRUE}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}









\begin{frame}[fragile]
  \frametitle{Posterior distributions}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{plot}\hlstd{(jags.post.samples.sp)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=0.6\linewidth]{figure/jc2-plot-1} 

}


\end{knitrout}
\end{frame}










\section{Spatial CJS with movement}









\begin{frame}
  \frametitle{Modeling dispersal among years}
  {\large What if activity centers move between years?}
  \begin{itemize}
    \normalsize
    \item Could affect estimates of detection parameters
    \item More importantly, might provide opportunity to study dispersal
  \end{itemize}
  \pause
  \vfill
  {\large Potential movement models}
  \begin{itemize}
    \normalsize
    \item Random walk: ${\bm s}_t \sim \mbox{Normal}({\bm s}_{t-1}, \tau^2)$
    \item Random walk with attraction point: ${\bm s}_t \sim \mbox{Normal}({\bm  s}_{t-1} + \rho(\bar{\bm s} - {\bm s}_{t-1}), \tau^2)$
    \item Extensions can be made to allow for resource selection,
      landscape resistance, etc\dots 
  \end{itemize}
\end{frame}








\begin{frame}[fragile]
  \frametitle{Simulating spatial CJS data with dispersal}
  \begin{columns}
    \footnotesize %\small
    \begin{column}{0.5\textwidth}%{0.5\dimexpr\paperwidth-10pt}
    Parameters and data dimensions
\begin{knitrout}\tiny
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{T} \hlkwb{<-} \hlnum{10}\hlstd{; K} \hlkwb{<-} \hlnum{3}\hlstd{; n} \hlkwb{<-} \hlnum{25} \hlcom{## same as before}
\hlstd{phi} \hlkwb{<-} \hlnum{0.7}\hlstd{; p0} \hlkwb{<-} \hlnum{0.4}\hlstd{; sigma} \hlkwb{<-} \hlnum{0.1}
\hlcom{## dispersal parameter (of random walk)}
\hlstd{tau} \hlkwb{<-} \hlnum{0.05}
\end{alltt}
\end{kframe}
\end{knitrout}
\pause
Activity centers take a random walk
\begin{knitrout}\tiny
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## state-space should be bigger}
\hlstd{xlim} \hlkwb{<-} \hlstd{ylim} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{1}\hlstd{)}
\hlstd{first} \hlkwb{<-} \hlkwd{rpois}\hlstd{(n,} \hlnum{1}\hlstd{)}\hlopt{+}\hlnum{1}
\hlstd{s} \hlkwb{<-} \hlkwd{array}\hlstd{(}\hlnum{NA}\hlstd{,} \hlkwd{c}\hlstd{(n,} \hlnum{2}\hlstd{, T))}
\hlkwa{for}\hlstd{(i} \hlkwa{in} \hlnum{1}\hlopt{:}\hlstd{n) \{}
    \hlstd{s[i,,first[i]]} \hlkwb{<-} \hlkwd{cbind}\hlstd{(}\hlkwd{runif}\hlstd{(}\hlnum{1}\hlstd{, xlim[}\hlnum{1}\hlstd{],}
                                  \hlstd{xlim[}\hlnum{2}\hlstd{]),}
                            \hlkwd{runif}\hlstd{(}\hlnum{1}\hlstd{, ylim[}\hlnum{1}\hlstd{],}
                                  \hlstd{ylim[}\hlnum{2}\hlstd{]))}
    \hlkwa{for}\hlstd{(t} \hlkwa{in} \hlstd{(first[i]}\hlopt{+}\hlnum{1}\hlstd{)}\hlopt{:}\hlstd{T) \{}
        \hlstd{s[i,}\hlnum{1}\hlstd{,t]} \hlkwb{<-} \hlkwd{rnorm}\hlstd{(}\hlnum{1}\hlstd{, s[i,}\hlnum{1}\hlstd{,t}\hlopt{-}\hlnum{1}\hlstd{], tau)}
        \hlstd{s[i,}\hlnum{2}\hlstd{,t]} \hlkwb{<-} \hlkwd{rnorm}\hlstd{(}\hlnum{1}\hlstd{, s[i,}\hlnum{2}\hlstd{,t}\hlopt{-}\hlnum{1}\hlstd{], tau)}
    \hlstd{\}}
\hlstd{\}}
\hlstd{d} \hlkwb{<-} \hlstd{p} \hlkwb{<-} \hlkwd{array}\hlstd{(}\hlnum{NA}\hlstd{,} \hlkwd{c}\hlstd{(n, J, T))}
\hlkwa{for}\hlstd{(i} \hlkwa{in} \hlnum{1}\hlopt{:}\hlstd{n) \{}
    \hlkwa{for}\hlstd{(t} \hlkwa{in} \hlnum{1}\hlopt{:}\hlstd{T) \{}
        \hlstd{d[i,,t]} \hlkwb{<-} \hlkwd{sqrt}\hlstd{((s[i,}\hlnum{1}\hlstd{,t]}\hlopt{-}\hlstd{x[,}\hlnum{1}\hlstd{])}\hlopt{^}\hlnum{2} \hlopt{+}
                        \hlstd{(s[i,}\hlnum{2}\hlstd{,t]}\hlopt{-}\hlstd{x[,}\hlnum{2}\hlstd{])}\hlopt{^}\hlnum{2}\hlstd{)}
        \hlstd{p[i,,t]} \hlkwb{<-} \hlstd{p0}\hlopt{*}\hlkwd{exp}\hlstd{(}\hlopt{-}\hlstd{d[i,,t]}\hlopt{^}\hlnum{2} \hlopt{/}
                          \hlstd{(}\hlnum{2}\hlopt{*}\hlstd{sigma}\hlopt{^}\hlnum{2}\hlstd{))}
    \hlstd{\}}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}
    \end{column}
    \pause
    \begin{column}{0.5\textwidth}%{0.5\dimexpr\paperwidth-10pt}
Generate $z$ and $y$
\begin{knitrout}\tiny
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{z} \hlkwb{<-} \hlkwd{matrix}\hlstd{(}\hlnum{NA}\hlstd{, n, T)}
\hlstd{y.move} \hlkwb{<-} \hlkwd{array}\hlstd{(}\hlnum{NA}\hlstd{,} \hlkwd{c}\hlstd{(n, J, K, T))}
\hlkwa{for}\hlstd{(i} \hlkwa{in} \hlnum{1}\hlopt{:}\hlstd{n) \{}
    \hlstd{z[i,first[i]]} \hlkwb{<-} \hlnum{1}
    \hlkwa{for}\hlstd{(t} \hlkwa{in} \hlstd{(first[i]}\hlopt{+}\hlnum{1}\hlstd{)}\hlopt{:}\hlstd{T) \{}
        \hlstd{z[i,t]} \hlkwb{<-} \hlkwd{rbinom}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{1}\hlstd{, z[i,t}\hlopt{-}\hlnum{1}\hlstd{]}\hlopt{*}\hlstd{phi)}
        \hlkwa{for}\hlstd{(j} \hlkwa{in} \hlnum{1}\hlopt{:}\hlstd{J) \{}
            \hlstd{y.move[i,j,}\hlnum{1}\hlopt{:}\hlstd{K,t]} \hlkwb{<-}
                \hlkwd{rbinom}\hlstd{(K,} \hlnum{1}\hlstd{, z[i,t]}\hlopt{*}\hlstd{p[i,j,t])}
        \hlstd{\}}
    \hlstd{\}}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{column}
  \end{columns}
\end{frame}





\begin{frame}[fragile]
  \frametitle{Movement of activity center 1}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{plot}\hlstd{(}\hlkwd{t}\hlstd{(s[}\hlnum{1}\hlstd{,,]),} \hlkwc{pch}\hlstd{=}\hlnum{16}\hlstd{,} \hlkwc{type}\hlstd{=}\hlstr{"o"}\hlstd{,} \hlkwc{xlab}\hlstd{=}\hlstr{"x"}\hlstd{,} \hlkwc{ylab}\hlstd{=}\hlstr{"y"}\hlstd{,}
     \hlkwc{xlim}\hlstd{=}\hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{ylim}\hlstd{=}\hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{1}\hlstd{),} \hlkwc{asp}\hlstd{=}\hlnum{1}\hlstd{,} \hlkwc{col}\hlstd{=}\hlstr{"blue"}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=0.65\linewidth]{figure/s1-1} 

}


\end{knitrout}
\end{frame}




\begin{frame}[fragile]
  \frametitle{Spatial CJS model with dispersal in JAGS}
  \vspace{-2mm}
  \tiny %\fbox{\parbox{\linewidth}{\verbatiminput{CJS-spatial-move.jag}}}
\begin{knitrout}\tiny
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{writeLines}\hlstd{(}\hlkwd{readLines}\hlstd{(}\hlstr{"CJS-spatial-move.jag"}\hlstd{))}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning in file(con, "{}r"{}): cannot open file 'CJS-spatial-move.jag': No such file or directory}}

{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in file(con, "{}r"{}): cannot open the connection}}\end{kframe}
\end{knitrout}
\end{frame}





\begin{frame}[fragile]
  \frametitle{JAGS}
  \small
  Data
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{jd.sp.move} \hlkwb{<-} \hlkwd{list}\hlstd{(}\hlkwc{y}\hlstd{=y.move,} \hlkwc{n}\hlstd{=n,} \hlkwc{first}\hlstd{=first,} \hlkwc{x}\hlstd{=x,}
                   \hlkwc{J}\hlstd{=J,} \hlkwc{K}\hlstd{=K,} \hlkwc{T}\hlstd{=T,} \hlkwc{xlim}\hlstd{=xlim,} \hlkwc{ylim}\hlstd{=ylim)}
\end{alltt}
\end{kframe}
\end{knitrout}
  Initial values for $z$ matrix
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{zi} \hlkwb{<-} \hlkwd{matrix}\hlstd{(}\hlnum{NA}\hlstd{, n, T)}
\hlkwa{for}\hlstd{(i} \hlkwa{in} \hlnum{1}\hlopt{:}\hlstd{n) \{}
    \hlstd{zi[i,(first[i]}\hlopt{+}\hlnum{1}\hlstd{)}\hlopt{:}\hlstd{T]} \hlkwb{<-} \hlnum{1}
    \hlstd{\}}
\hlstd{ji.sp.move} \hlkwb{<-} \hlkwa{function}\hlstd{()} \hlkwd{list}\hlstd{(}\hlkwc{phi}\hlstd{=}\hlkwd{runif}\hlstd{(}\hlnum{1}\hlstd{),} \hlkwc{z}\hlstd{=zi)}
\hlstd{jp.sp.move} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlstr{"phi"}\hlstd{,} \hlstr{"p0"}\hlstd{,} \hlstr{"sigma"}\hlstd{,} \hlstr{"tau"}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
  \pause
  \vfill
  Fit the model
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{jps.sp.move} \hlkwb{<-} \hlkwd{jags.basic}\hlstd{(}\hlkwc{data}\hlstd{=jd.sp.move,}
                          \hlkwc{inits}\hlstd{=ji.sp.move,}
                          \hlkwc{parameters.to.save}\hlstd{=jp.sp.move,}
                          \hlkwc{model.file}\hlstd{=}\hlstr{"CJS-spatial-move.jag"}\hlstd{,}
                          \hlkwc{n.chains}\hlstd{=}\hlnum{3}\hlstd{,} \hlkwc{n.adapt}\hlstd{=}\hlnum{100}\hlstd{,} \hlkwc{n.burnin}\hlstd{=}\hlnum{0}\hlstd{,}
                          \hlkwc{n.iter}\hlstd{=}\hlnum{2000}\hlstd{,} \hlkwc{parallel}\hlstd{=}\hlnum{TRUE}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}



\begin{frame}[fragile]
  \frametitle{Posterior distributions}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{plot}\hlstd{(jps.sp.move[,jp.sp.move])}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=0.6\linewidth]{figure/jc3-plot-1} 

}


\end{knitrout}
\end{frame}






\begin{frame}
  \frametitle{Summary}
  \large
%  Key points
%  \begin{itemize}[<+->]
%  \item
  Spatial CJS models allow for inference about survival,
  movement, and capture probability \\
  \pause \vfill
  % \item
  We could have considered many other movement models \\
  \pause \vfill
  % \item
  Next, we'll use Jolly-Seber models to study spatio-temporal
  variation in abundance and recruitment too \\
%  \end{itemize}
\end{frame}



% \begin{frame}
%   \frametitle{Assignment}
%   {\bf \large For next week}
%   \begin{enumerate}[\bf (1)]
%     \item Modify {\tt CJS-spatial.jag} to estimate yearly survival
%     \item Work on analysis of your own data
%     \item Prepare a 2-min presentation on your planned analysis.
%     \item Paper should be a minimum of 4 pages, single-spaced, 12-pt
%       font, including:
%       \begin{itemize}
%         \item Introduction
%         \item Methods (including model description)
%         \item Results (with figures)
%         \item Discussion
%       \end{itemize}
%   \end{enumerate}
% \end{frame}


\end{document}









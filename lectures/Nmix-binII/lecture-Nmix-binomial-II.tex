\documentclass[color=usenames,dvipsnames]{beamer}\usepackage[]{graphicx}\usepackage[]{color}
% maxwidth is the original width if it is less than linewidth
% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0, 0, 0}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.69,0.494,0}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.749,0.012,0.012}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.514,0.506,0.514}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0,0,0}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0,0.341,0.682}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0,0,0}{\textbf{#1}}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.004,0.004,0.506}{#1}}%
\let\hlipl\hlkwb

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
%\documentclass[color=usenames,dvipsnames,handout]{beamer}

\usepackage[roman]{../lectures}
%\usepackage[sans]{../lectures}


\hypersetup{pdfpagemode=UseNone,pdfstartview={FitV}}



% Load function to compile and open PDF


% Compile and open PDF






%% New command for inline code that isn't to be evaluated
\definecolor{inlinecolor}{rgb}{0.878, 0.918, 0.933}
\newcommand{\inr}[1]{\colorbox{inlinecolor}{\texttt{#1}}}
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}




\begin{frame}[plain]
  \LARGE
%  \maketitle
  \centering
  {\LARGE Lecture 7 -- Binomial $N$-mixture models: \\
    model selection and goodness-of-fit} \\  
  {\color{default} \rule{\textwidth}{0.1pt}}
  \vfill
  \large
  WILD(FISH) 8390 \\
  Estimation of Fish and Wildlife Population Parameters \\
  \vfill
  \large
  Richard Chandler \\
  University of Georgia \\
\end{frame}





\section{Model selection}



\begin{frame}[plain]
  \frametitle{Outline}
  \Large
  \only<1>{\tableofcontents}%[hideallsubsections]}
  \only<2 | handout:0>{\tableofcontents[currentsection]}%,hideallsubsections]}
\end{frame}





\begin{frame}
  \frametitle{Model selection}
  In scientific contexts, we want models that describe natural
  processes and allow us to evaluate hypotheses. \\
  \pause
  \vfill
  Models should be predictive, but they shouldn't be crafted with the
  sole goal of prediction in mind. \\
  \pause
  \vfill
  Scientists typically don't care about prediction if nothing is
  learned about the processes that gave rise to the data. \\
  \pause
  \vfill
  That said, predictive performance is often the best way
  to compare models and avoid over-fitting. \\
  \pause
  \vfill
  Just make sure the models being compared were motivated by clear
  hypotheses.
\end{frame}




\begin{frame}
  \frametitle{Model selection}
  Prediction accuracy increases with model complexity up to a point,
  until over-fitting kicks in. \\
  \pause
  \vfill
  How do we determine when a model is too simplistic or too complex? \\
  \pause
  \vfill
  The best way to evaluate predictive performance is to compare
  predictions to new observations, but we rarely have the resources to
  collect additional data for the sake of prediction. \\
  % \pause
  % \vfill
  % Trouble is, people rarely collect new observations. \\
  \pause
  \vfill
  A cheapter (albeit less desirable) alternative is to use
  cross-validation: 
  \begin{itemize}
    \item Split data into K partitions
    \item Fit model to K-1 partitions
    \item Predict the holdout partition
  \end{itemize}
  \pause
  \vfill
  Information criteria like AIC and WAIC yield similar predictive
  rankings, but with less computation.    
\end{frame}



\subsection{Likelihood-based methods}



\begin{frame}
  \frametitle{Outline}
  \Large
  \tableofcontents[currentsection,currentsubsection]
\end{frame}



\begin{frame}
  \frametitle{Model selection with AIC}
  Akaike's `An Information Criterion' approximately leave-one-out
  cross validation, and it's very easy to calculate:
  \[
     \mathrm{AIC} = -2\times \mathrm{logLikelihood} + 2\times \mathrm{nParameters}
  \]
\end{frame}




\bgroup
\let\oldfootnoterule\footnoterule
\def\footnoterule{\only<2->\oldfootnoterule}
\begin{frame}[fragile]
  \frametitle{Model selection in `unmarked'}
  \small
  Import the grouse data
  \vspace{-6pt}
\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{library}\hlstd{(unmarked)}
\hlstd{grouse.data} \hlkwb{<-} \hlkwd{read.csv}\hlstd{(}\hlstr{"grouse_data_Nmix.csv"}\hlstd{,} \hlkwc{row.names}\hlstd{=}\hlnum{1}\hlstd{)}
\hlstd{grouse.umf} \hlkwb{<-} \hlkwd{unmarkedFramePCount}\hlstd{(}
    \hlkwc{y}\hlstd{=grouse.data[,}\hlkwd{paste0}\hlstd{(}\hlstr{"grouse"}\hlstd{,}\hlnum{1}\hlopt{:}\hlnum{3}\hlstd{)],}
    \hlkwc{siteCovs}\hlstd{=grouse.data[,}\hlkwd{c}\hlstd{(}\hlstr{"utmE"}\hlstd{,}\hlstr{"utmN"}\hlstd{,}\hlstr{"elevation"}\hlstd{)],}
    \hlkwc{obsCovs}\hlstd{=}\hlkwd{list}\hlstd{(}\hlkwc{temp}\hlstd{=grouse.data[,}\hlkwd{paste0}\hlstd{(}\hlstr{"Temperature."}\hlstd{,}\hlnum{1}\hlopt{:}\hlnum{3}\hlstd{)]))}
\end{alltt}
\end{kframe}
\end{knitrout}
\pause
\vfill
Standardize the covariates\footnote<2->{\inr{scale} will only work if all the covariates are continuous}:
  \vspace{-6pt}
\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{site.covs.s} \hlkwb{<-} \hlkwd{scale}\hlstd{(}\hlkwd{siteCovs}\hlstd{(grouse.umf))}
\hlkwd{colnames}\hlstd{(site.covs.s)} \hlkwb{<-} \hlkwd{paste0}\hlstd{(}\hlkwd{colnames}\hlstd{(site.covs.s),} \hlstr{".s"}\hlstd{)}
\hlkwd{siteCovs}\hlstd{(grouse.umf)} \hlkwb{<-} \hlkwd{cbind}\hlstd{(}\hlkwd{siteCovs}\hlstd{(grouse.umf), site.covs.s)}
\hlkwd{obsCovs}\hlstd{(grouse.umf)} \hlkwb{<-} \hlkwd{scale}\hlstd{(}\hlkwd{obsCovs}\hlstd{(grouse.umf))}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}
\egroup




\begin{frame}[fragile]
  \frametitle{Model selection in `unmarked'}
  \small
  Fit some models
  \vspace{-6pt}
\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{fm1} \hlkwb{<-} \hlkwd{pcount}\hlstd{(}\hlopt{~}\hlstd{temp} \hlopt{~} \hlstd{elevation.s}\hlopt{+}\hlstd{utmE.s}\hlopt{+}\hlstd{utmN.s, grouse.umf,} \hlkwc{K}\hlstd{=}\hlnum{50}\hlstd{)}
\hlstd{fm2} \hlkwb{<-} \hlkwd{pcount}\hlstd{(}\hlopt{~}\hlstd{temp} \hlopt{~} \hlstd{elevation.s}\hlopt{+}\hlstd{utmN.s, grouse.umf,} \hlkwc{K}\hlstd{=}\hlnum{50}\hlstd{)}
\hlstd{fm3} \hlkwb{<-} \hlkwd{pcount}\hlstd{(}\hlopt{~}\hlstd{temp} \hlopt{~} \hlstd{elevation.s, grouse.umf,} \hlkwc{K}\hlstd{=}\hlnum{50}\hlstd{)}
\hlstd{fm4} \hlkwb{<-} \hlkwd{pcount}\hlstd{(}\hlopt{~}\hlnum{1} \hlopt{~} \hlstd{elevation.s}\hlopt{+}\hlstd{utmN.s, grouse.umf,} \hlkwc{K}\hlstd{=}\hlnum{50}\hlstd{)}
\hlstd{fm5} \hlkwb{<-} \hlkwd{pcount}\hlstd{(}\hlopt{~}\hlnum{1} \hlopt{~} \hlstd{elevation.s, grouse.umf,} \hlkwc{K}\hlstd{=}\hlnum{50}\hlstd{)}
\hlstd{fm6} \hlkwb{<-} \hlkwd{pcount}\hlstd{(}\hlopt{~}\hlnum{1} \hlopt{~} \hlnum{1}\hlstd{, grouse.umf,} \hlkwc{K}\hlstd{=}\hlnum{50}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
\pause
\vfill
Put models in a special type of list
  \vspace{-6pt}
\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{grouse.models} \hlkwb{<-} \hlkwd{fitList}\hlstd{(}\hlstr{'lam(elev+utmE+utmN)p(temp)'}\hlstd{=fm1,}
                         \hlstr{'lam(elev+utmN)p(temp)'}\hlstd{=fm2,}
                         \hlstr{'lam(elev)p(ptemp)'}\hlstd{=fm3,}
                         \hlstr{'lam(elev+utmN)p(.)'}\hlstd{=fm4,}
                         \hlstr{'lam(elev)p(.)'}\hlstd{=fm5,}
                         \hlstr{'lam(.)p(.)'}\hlstd{=fm6)}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in validityMethod(object): Data are not the same among models due to missing covariate values. Consider removing NAs before analysis.}}\end{kframe}
\end{knitrout}
\pause
Uh oh, missing values differ among models.
\end{frame}



\begin{frame}[fragile]
  \frametitle{Model selection in `unmarked'}
  \small
  Replace count data with \inr{NA} when associated covariates are missing:
  \vspace{-6pt}
\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{na.sites} \hlkwb{<-} \hlkwd{apply}\hlstd{(}\hlkwd{is.na}\hlstd{(site.covs.s),} \hlnum{1}\hlstd{, any)}
\hlstd{grouse.counts} \hlkwb{<-} \hlkwd{getY}\hlstd{(grouse.umf)}
\hlstd{grouse.counts[na.sites,]} \hlkwb{<-} \hlnum{NA}
\hlstd{grouse.umf}\hlopt{@}\hlkwc{y} \hlkwb{<-} \hlstd{grouse.counts}
\end{alltt}
\end{kframe}
\end{knitrout}
  \pause
  \vfill
  Fit the models again
  \vspace{-6pt}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{fm1} \hlkwb{<-} \hlkwd{pcount}\hlstd{(}\hlopt{~}\hlstd{temp} \hlopt{~} \hlstd{elevation.s}\hlopt{+}\hlstd{utmE.s}\hlopt{+}\hlstd{utmN.s, grouse.umf,} \hlkwc{K}\hlstd{=}\hlnum{50}\hlstd{)}
\hlstd{fm2} \hlkwb{<-} \hlkwd{pcount}\hlstd{(}\hlopt{~}\hlstd{temp} \hlopt{~} \hlstd{elevation.s}\hlopt{+}\hlstd{utmN.s, grouse.umf,} \hlkwc{K}\hlstd{=}\hlnum{50}\hlstd{)}
\hlstd{fm3} \hlkwb{<-} \hlkwd{pcount}\hlstd{(}\hlopt{~}\hlstd{temp} \hlopt{~} \hlstd{elevation.s, grouse.umf,} \hlkwc{K}\hlstd{=}\hlnum{50}\hlstd{)}
\hlstd{fm4} \hlkwb{<-} \hlkwd{pcount}\hlstd{(}\hlopt{~}\hlnum{1} \hlopt{~} \hlstd{elevation.s}\hlopt{+}\hlstd{utmN.s, grouse.umf,} \hlkwc{K}\hlstd{=}\hlnum{50}\hlstd{)}
\hlstd{fm5} \hlkwb{<-} \hlkwd{pcount}\hlstd{(}\hlopt{~}\hlnum{1} \hlopt{~} \hlstd{elevation.s, grouse.umf,} \hlkwc{K}\hlstd{=}\hlnum{50}\hlstd{)}
\hlstd{fm6} \hlkwb{<-} \hlkwd{pcount}\hlstd{(}\hlopt{~}\hlnum{1} \hlopt{~} \hlnum{1}\hlstd{, grouse.umf,} \hlkwc{K}\hlstd{=}\hlnum{50}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
\pause
\vfill
Put models in a \inr{fitList}
  \vspace{-6pt}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{grouse.models} \hlkwb{<-} \hlkwd{fitList}\hlstd{(}\hlstr{'lam(elev+utmE+utmN)p(temp)'}\hlstd{=fm1,}
                         \hlstr{'lam(elev+utmN)p(temp)'}\hlstd{=fm2,}
                         \hlstr{'lam(elev)p(ptemp)'}\hlstd{=fm3,}
                         \hlstr{'lam(elev+utmN)p(.)'}\hlstd{=fm4,}
                         \hlstr{'lam(elev)p(.)'}\hlstd{=fm5,}
                         \hlstr{'lam(.)p(.)'}\hlstd{=fm6)}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}




\begin{frame}[fragile]
  \frametitle{Model selection in `unmarked'}
  \small
  Create AIC table
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{modSel}\hlstd{(grouse.models)}
\end{alltt}
\begin{verbatim}
##                            nPars    AIC delta   AICwt cumltvWt
## lam(elev+utmN)p(temp)          5 202.89  0.00 5.1e-01     0.51
## lam(elev+utmE+utmN)p(temp)     6 203.76  0.87 3.3e-01     0.84
## lam(elev)p(ptemp)              4 206.09  3.20 1.0e-01     0.95
## lam(elev+utmN)p(.)             4 208.25  5.36 3.5e-02     0.98
## lam(elev)p(.)                  3 209.72  6.83 1.7e-02     1.00
## lam(.)p(.)                     2 222.52 19.63 2.8e-05     1.00
\end{verbatim}
\end{kframe}
\end{knitrout}
  \pause
  \vfill
  We could use the model with the lowest AIC for inference. \\
  \pause
  \vfill
  Later in the course, we'll talk about model-averaging predictions
\end{frame}






\subsection{Bayesian methods}



\begin{frame}
  \frametitle{Outline}
  \Large
  \tableofcontents[currentsection,currentsubsection]
\end{frame}





\begin{frame}[fragile]
  \frametitle{Data, inits, and parameters}
  Put data in a named list
  \vspace{6pt}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{jags.data} \hlkwb{<-} \hlkwd{list}\hlstd{(}\hlkwc{y}\hlstd{=grouse.counts,}
                  \hlkwc{elevation}\hlstd{=site.covs.s[,}\hlstr{"elevation.s"}\hlstd{],}
                  \hlkwc{utmE}\hlstd{=site.covs.s[,}\hlstr{"utmE.s"}\hlstd{],}
                  \hlkwc{utmN}\hlstd{=site.covs.s[,}\hlstr{"utmN.s"}\hlstd{],}
                  \hlkwc{temp}\hlstd{=}\hlkwd{as.matrix}\hlstd{(grouse.data[,}\hlkwd{paste0}\hlstd{(}\hlstr{"Temperature."}\hlstd{,}\hlnum{1}\hlopt{:}\hlnum{3}\hlstd{)]),}
                  \hlkwc{nSites}\hlstd{=}\hlkwd{nrow}\hlstd{(grouse.counts),}
                  \hlkwc{nOccasions}\hlstd{=}\hlkwd{ncol}\hlstd{(grouse.counts))}
\hlstd{jags.data}\hlopt{$}\hlstd{temp} \hlkwb{<-} \hlstd{(jags.data}\hlopt{$}\hlstd{temp}\hlopt{-}\hlkwd{mean}\hlstd{(jags.data}\hlopt{$}\hlstd{temp,} \hlkwc{na.rm}\hlstd{=}\hlnum{TRUE}\hlstd{))}\hlopt{/}
    \hlkwd{sd}\hlstd{(jags.data}\hlopt{$}\hlstd{temp,} \hlkwc{na.rm}\hlstd{=}\hlnum{TRUE}\hlstd{)} \hlcom{# standardize temp}
\end{alltt}
\end{kframe}
\end{knitrout}
\pause
\vfill
  Initial values
  \vspace{-6pt}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{jags.inits} \hlkwb{<-} \hlkwa{function}\hlstd{() \{}
    \hlkwd{list}\hlstd{(}\hlkwc{lambda.intercept}\hlstd{=}\hlkwd{runif}\hlstd{(}\hlnum{1}\hlstd{),} \hlkwc{alpha0}\hlstd{=}\hlkwd{rnorm}\hlstd{(}\hlnum{1}\hlstd{),}
         \hlkwc{N}\hlstd{=}\hlkwd{rep}\hlstd{(}\hlnum{2}\hlstd{, jags.data}\hlopt{$}\hlstd{nSites))}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}
\pause
\vfill
  Parameters to monitor
  \vspace{-6pt}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{jags.pars} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlstr{"beta0"}\hlstd{,} \hlstr{"beta1"}\hlstd{,} \hlstr{"beta2"}\hlstd{,} \hlstr{"beta3"}\hlstd{,}
               \hlstr{"alpha0"}\hlstd{,} \hlstr{"alpha1"}\hlstd{,} \hlstr{"totalAbundance"}\hlstd{,}
               \hlstr{"ld.y.dot"}\hlstd{,} \hlstr{"ld.ydot.N"}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}





\begin{frame}[fragile]
  \frametitle{MCMC}
  \small
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{library}\hlstd{(jagsUI)}
\hlstd{jags.data1} \hlkwb{<-} \hlstd{jags.data}
\hlstd{jags.data1}\hlopt{$}\hlstd{modswitch} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,}\hlnum{1}\hlstd{,}\hlnum{1}\hlstd{,}\hlnum{1}\hlstd{)} \hlcom{## Include all covariates}
\hlstd{jm1} \hlkwb{<-} \hlkwd{jags.basic}\hlstd{(}\hlkwc{data}\hlstd{=jags.data1,} \hlkwc{inits}\hlstd{=jags.inits,}
                  \hlkwc{parameters.to.save}\hlstd{=jags.pars,}
                  \hlkwc{model.file}\hlstd{=}\hlstr{"Nmix-model-grouse1.jag"}\hlstd{,}
                  \hlkwc{n.chains}\hlstd{=}\hlnum{3}\hlstd{,} \hlkwc{n.adapt}\hlstd{=}\hlnum{100}\hlstd{,} \hlkwc{n.burnin}\hlstd{=}\hlnum{0}\hlstd{,}
                  \hlkwc{n.iter}\hlstd{=}\hlnum{2000}\hlstd{,} \hlkwc{parallel}\hlstd{=}\hlnum{TRUE}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}


\begin{frame}[fragile]
  \frametitle{MCMC}
  \small
  Model 2
\begin{knitrout}\tiny
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{jags.data2} \hlkwb{<-} \hlstd{jags.data; jags.data2}\hlopt{$}\hlstd{modswitch} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,}\hlnum{0}\hlstd{,}\hlnum{1}\hlstd{,}\hlnum{1}\hlstd{)}
\hlstd{jm2} \hlkwb{<-} \hlkwd{jags.basic}\hlstd{(}\hlkwc{data}\hlstd{=jags.data2,} \hlkwc{inits}\hlstd{=jags.inits,} \hlkwc{parameters.to.save}\hlstd{=jags.pars,}
                  \hlkwc{model.file}\hlstd{=}\hlstr{"Nmix-model-grouse1.jag"}\hlstd{,} \hlkwc{n.chains}\hlstd{=}\hlnum{3}\hlstd{,} \hlkwc{n.adapt}\hlstd{=}\hlnum{100}\hlstd{,} \hlkwc{n.burnin}\hlstd{=}\hlnum{0}\hlstd{,}
                  \hlkwc{n.iter}\hlstd{=}\hlnum{2000}\hlstd{,} \hlkwc{parallel}\hlstd{=}\hlnum{TRUE}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
  Model 6
\begin{knitrout}\tiny
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{jags.data6} \hlkwb{<-} \hlstd{jags.data; jags.data6}\hlopt{$}\hlstd{modswitch} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,}\hlnum{0}\hlstd{,}\hlnum{0}\hlstd{,}\hlnum{0}\hlstd{)}
\hlstd{jm6} \hlkwb{<-} \hlkwd{jags.basic}\hlstd{(}\hlkwc{data}\hlstd{=jags.data6,} \hlkwc{inits}\hlstd{=jags.inits,} \hlkwc{parameters.to.save}\hlstd{=jags.pars,}
                  \hlkwc{model.file}\hlstd{=}\hlstr{"Nmix-model-grouse1.jag"}\hlstd{,} \hlkwc{n.chains}\hlstd{=}\hlnum{3}\hlstd{,} \hlkwc{n.adapt}\hlstd{=}\hlnum{100}\hlstd{,} \hlkwc{n.burnin}\hlstd{=}\hlnum{0}\hlstd{,}
                  \hlkwc{n.iter}\hlstd{=}\hlnum{2000}\hlstd{,} \hlkwc{parallel}\hlstd{=}\hlnum{TRUE}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}


\begin{frame}[fragile]
  \frametitle{WAIC}
\begin{knitrout}\small
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{waic} \hlkwb{<-} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{,} \hlkwc{focus}\hlstd{=}\hlkwd{c}\hlstd{(}\hlstr{"y"}\hlstd{,} \hlstr{"yN"}\hlstd{)) \{}
    \hlstd{vars} \hlkwb{<-} \hlstd{coda}\hlopt{::}\hlkwd{varnames}\hlstd{(x)}
    \hlkwa{if}\hlstd{(focus[}\hlnum{1}\hlstd{]}\hlopt{==}\hlstr{"y"}\hlstd{) \{}
        \hlstd{ld.samples} \hlkwb{<-} \hlkwd{as.matrix}\hlstd{(x[,}\hlkwd{grep}\hlstd{(}\hlstr{"ld.y.dot"}\hlstd{, vars)])}
    \hlstd{\}} \hlkwa{else if}\hlstd{(focus[}\hlnum{1}\hlstd{]}\hlopt{==}\hlstr{"yN"}\hlstd{) \{}
        \hlstd{ld.samples} \hlkwb{<-} \hlkwd{as.matrix}\hlstd{(x[,}\hlkwd{grep}\hlstd{(}\hlstr{"ld.ydot.N"}\hlstd{, vars)])}
    \hlstd{\}} \hlkwa{else} \hlkwd{stop}\hlstd{(}\hlstr{"focus should be either 'y' or 'yN'"}\hlstd{)}
    \hlstd{lppd} \hlkwb{<-} \hlkwd{sum}\hlstd{(}\hlkwd{log}\hlstd{(}\hlkwd{colMeans}\hlstd{(}\hlkwd{exp}\hlstd{(ld.samples))))}
    \hlstd{penalty} \hlkwb{<-} \hlkwd{sum}\hlstd{(}\hlkwd{apply}\hlstd{(ld.samples,} \hlnum{2}\hlstd{, var))}
    \hlkwd{return}\hlstd{(}\hlopt{-}\hlnum{2}\hlopt{*}\hlstd{(lppd}\hlopt{-}\hlstd{penalty))}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}


\begin{frame}[fragile]
  \frametitle{WAIC}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{(waic1} \hlkwb{<-} \hlkwd{waic}\hlstd{(jm1,} \hlkwc{focus}\hlstd{=}\hlstr{"yN"}\hlstd{))}
\end{alltt}
\begin{verbatim}
## [1] 914.3635
\end{verbatim}
\end{kframe}
\end{knitrout}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{(waic2} \hlkwb{<-} \hlkwd{waic}\hlstd{(jm2,} \hlkwc{focus}\hlstd{=}\hlstr{"yN"}\hlstd{))}
\end{alltt}
\begin{verbatim}
## [1] 768.326
\end{verbatim}
\end{kframe}
\end{knitrout}
\begin{knitrout}\scriptsize
\definecolor{shadecolor}{rgb}{0.878, 0.918, 0.933}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{(waic6} \hlkwb{<-} \hlkwd{waic}\hlstd{(jm6,} \hlkwc{focus}\hlstd{=}\hlstr{"yN"}\hlstd{))}
\end{alltt}
\begin{verbatim}
## [1] 1076.055
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}



\section{Goodness-of-fit}



\begin{frame}[plain]
  \frametitle{Outline}
  \Large
  \tableofcontents[currentsection]
\end{frame}



\begin{frame}
  \frametitle{Goodness-of-fit}
  \small
  Distributional assumptions determine the expected values
  \alert{and the expected variance} of the random variables, including
  the data. \\  
  \pause
  \vfill
  Overdispersion occurs when there is more variance in the data than
  expected by the model. \\
  \pause
  \vfill
  Goodness-of-fit method assess over and underdispersion. \\
  \pause
  \vfill
  If the model does not fit the data very well because of
  overdispersion, there are several remedial actions:
  \begin{itemize}
  \item<5-> Scientific approach
    \begin{itemize}
       \item Figure out why there is unexplained variation
       \item Perhaps there were unmeasured covariates or you need a
         better model for describing the processes
    \end{itemize}
  \item<6-> Statistical approach
    \begin{itemize}
      \item Soak up variation with random effects
      \item Use a different distribution (we'll start here)
    \end{itemize}
  \end{itemize}
\end{frame}



\bgroup
\let\oldfootnoterule\footnoterule
\def\footnoterule{\only<3->\oldfootnoterule}
\begin{frame}
  \frametitle{Changing the distribution for $N$}
  \small
  Standard Poisson-binomial $N$-mixture model (without covariates):
  \begin{gather*}
%    \mathrm{log}(\lambda_i) = \beta_0 + \beta_1 {\color{blue} x_{i1}} +
%    \beta_2 {\color{blue} x_{i2}} + \cdots \\
    N_i \sim \mathrm{Poisson}(\lambda) \\
%    \mathrm{logit}(p_{ij}) = \alpha_0 + \alpha_1 {\color{blue} x_{i1}}
%    + \alpha_2 {\color{Purple} w_{ij}} + \cdots \\
    y_{ij} \sim \mathrm{Binomial}(N_i, p)
  \end{gather*}
  \pause
%  \vfill
  We can replace the Poisson distribution with other distributions
  that allow for greater variance in $N$. \pause Two common examples
  are the negative 
  binomial:
  \begin{equation*}
    N_i \sim \mathrm{NegBin}(\lambda_i, \kappa)
  \end{equation*}
  where $\lambda_i$ is the expected value of $N$ and $\kappa$ is the
  dispersion parameter\footnote<3->{There are several other
    parameterizations of the negative binomial}.
  \pause
%  \vfill
  Another option is the zero-inflated Poisson:
  \begin{columns}
    \begin{column}{0.45\textwidth}
      \begin{gather*}
        N_i \sim \mathrm{Poisson}(\lambda_i z_i) \\
        z_i \sim \mathrm{Bern}(\psi) \\
      \end{gather*}
    \end{column}
    \begin{column}{0.1\textwidth}
%      \centering
%      Or \\
      \rule{0.1pt}{24pt} \\
    \end{column}
    \begin{column}{0.45\textwidth}
      \begin{gather*}
        \hspace{-72pt}
        N_i \sim \mathrm{ZIPoisson}(\lambda_i,\psi) \\
      \end{gather*}
    \end{column}
  \end{columns}
  where $\psi$ is the expected proportion of sites with excess zeros. 
\end{frame}
\egroup



\subsection{Likelihood-based methods}



\begin{frame}[fragile]
  \frametitle{Goodness-of-fit in `unmarked'}
  
\end{frame}






% \begin{frame}[fragile]
%   \frametitle{\normalsize Empirical Bayes -- Site-level abundance}
% <<ranef,size='scriptsize',out.width='80%',fig.align='center',fig.width=9>>=
% re <- ranef(fm)
% plot(re, layout=c(4,3), subset=site%in%1:12, xlim=c(-1, 11), lwd=5)
% @   
% \end{frame}





% \begin{frame}[fragile]
%   \frametitle{Total abundance (in surveyed region)}
% <<Ntotal,size='scriptsize',out.width='60%',fig.align='center'>>=
% N.total.post <- predict(re, func=sum, nsim=1000)
% hist(N.total.post, freq=FALSE, main="", xlab="N total", ylab="Probability")
% @   
% \end{frame}







\subsection{Bayesian methods}



\begin{frame}[plain]
  \frametitle{Outline}
  \Large
  \tableofcontents[currentsection,currentsubsection]
\end{frame}







\section{Assignment}




\begin{frame}[fragile]
  \frametitle{Assignment}
  % \small
  \footnotesize
  Create a self-contained R script or Rmarkdown file
  to do the following:
  \vfill
  \begin{enumerate}
%    \small
    \footnotesize
    \item Using the simulated data, compare the prior and posterior
      predictive distributions of $\lambda$ for each of the 3 forest
      types. 
    \item Change the priors for $\alpha_0$ and $\alpha_1$ from
      \inr{dnorm(0,0.5)} to \inr{dnorm(0, 0.001)} and then compare the
      prior and posterior predictions of $p$ as a function of
      temperature. Make the same graph as we made above. How
      sensitive is the posterior to the prior?
    \item Fit a binomial $N$-mixture model to the Canada warbler data
      using `unmarked'. The data include: 
      \begin{itemize}
        \footnotesize
        \item Response: \texttt{cawa1, cawa2, cawa3, cawa4}
        \item Site covs: \texttt{Elevation, Wind, Noise}
      \end{itemize}
    \item Graph the predictions of $\lambda$ over the 
      elevation range, along with 95\% CIs.
  \end{enumerate}
  \vfill
  Upload your {\tt .R} or {\tt .Rmd} file to ELC before Monday. 
\end{frame}





\end{document}

